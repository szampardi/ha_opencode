---
name: "HA OpenCode"
description: "AI coding agent for editing Home Assistant configuration with deep MCP integration and LSP support"
version: "2.0.2"
slug: "ha_opencode"
image: "docker.io/nexus166/ha_opencode"
url: "https://github.com/szampardi/ha_opencode"
arch:
  - aarch64
  - amd64
startup: application
init: false

# Ingress configuration
ingress: true
ingress_port: 4096
ingress_stream: true
panel_icon: mdi:robot
panel_title: HA OpenCode

# Direct access port (optional)
ports:
  4096/tcp: 4096
ports_description:
  4096/tcp: OpenCode web UI (direct access)

# File access - Home Assistant config directory
map:
  - type: homeassistant_config
    read_only: false

# API access - needed for logs
hassio_api: true
hassio_role: default
homeassistant_api: true

# Security - keep permissions minimal
host_network: false
privileged: []
apparmor: true

# User-configurable options
options:
  # Feature toggles
  mcp_enabled: false
  lsp_enabled: true

  # OpenCode config.json (raw JSON string)
  opencode_config_json: ""

  # OpenCode serve options
  serve_print_logs: true
  serve_log_level: "DEBUG"
  serve_port: 4096
  serve_hostname: "0.0.0.0"
  serve_mdns: false
  serve_cors: []

schema:
  # Feature toggles
  mcp_enabled: bool
  lsp_enabled: bool

  # OpenCode config.json (raw JSON string)
  opencode_config_json: str?

  # OpenCode serve options
  serve_print_logs: bool
  serve_log_level: list(DEBUG|INFO|WARN|ERROR)
  serve_port: int(1,65535)
  serve_hostname: str
  serve_mdns: bool
  serve_cors: list(str)

# Exclude caches from backups
backup_exclude:
  - ".npm/*"
  - ".cache/*"
  - ".local/share/opencode/cache/*"
